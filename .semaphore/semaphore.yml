version: v1.0

name: Test

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:

  - name: "Test on Windows"
    dependencies: []
    task:
      prologue:
        commands:
          - checkout
      agent:
        machine:
          type: s1-consoles
      jobs:
        - name: test (debug)
          commands:
            - & premake5 vs2019
            - & devenv visualstudio/next.sln /Build debug
            - & ./bin/test
        - name: test (release)
          commands:
            - & premake5 vs2019
            - & devenv visualstudio/next.sln /Build release
            - & ./bin/test
        - name: test (memorycheck)
          commands:
            - & premake5 vs2019
            - & devenv visualstudio/next.sln /Build memorycheck
            - & ./bin/test

  - name: "Windows"
    dependencies: []
    task:
      prologue:
        commands:
          - checkout
      agent:
        machine:
          type: s1-consoles
      jobs:
        - name: win32 debug
          commands:
            - & devenv build/win32/win32.sln /Build Debug
        - name: win32 release
          commands:
            - & devenv build/win32/win32.sln /Build Release
        - name: win64 debug
          commands:
            - & devenv build/win64/win64.sln /Build Debug
        - name: win64 release
          commands:
            - & devenv build/win64/win64.sln /Build Release
